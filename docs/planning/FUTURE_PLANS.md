# Future Security Plan: Cloudflare Turnstile

We have deferred the implementation of Cloudflare Turnstile. This document outlines the steps to enable it when ready.

## Goal
Prevent automated scripts and unauthorized clients from accessing the API by verifying a cryptographic token generated by a challenge widget on the frontend.

## Prerequisites
1.  Cloudflare Account (Turnstile enabled).
2.  Site Key (Public) and Secret Key (Private).

## Implementation Steps

### 1. Frontend Integration (Client-Side)
Add the Turnstile widget to your application:

```html
<script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>

<div class="cf-turnstile" data-sitekey="YOUR_SITE_KEY" data-callback="javascriptCallback"></div>
```

Update your API calls to include the token:

```javascript
// Get token from Turnstile widget
const token = turnstile.getResponse();

fetch('https://your-worker.workers.dev/api/data', {
  headers: {
    'X-Turnstile-Token': token
  }
});
```

### 2. Backend Configuration (Server-Side)
The code is already prepared in `src/turnstile.ts` and `src/router.ts`.

To enable enforcement:
1.  Open `config.json`.
2.  Set `turnstileSecretKey` to your actual Cloudflare Secret Key.

```json
{
  "turnstileSecretKey": "1x0000000000000000000000000000000AA"
}
```

### 3. Deployment
Deploy the updated configuration to KV:

```bash
wrangler kv:key put --namespace-id=YOUR_KV_ID "config" --path=config.json
```
